(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var t=function(){function t(e,n,o,r){var i=r.handleCardClick,a=r.like,s=r.dislike,c=r.handleDeleteCard;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._selectorTemplate=e,this._handleCardClick=i,this._cardName=o.name,this._cardLink=o.link,this._cardLikes=o.likes.length,this._like=a,this._dislike=s,this._id=o._id,this._likes=o.likes,this._ownerId=n,this._cardOwnerId=o.owner._id,this._handleDeleteCard=c}var n,o;return n=t,(o=[{key:"_getTemplate",value:function(){return document.querySelector(this._selectorTemplate).content.querySelector(".element").cloneNode(!0)}},{key:"generateCard",value:function(){return this._element=this._getTemplate(),this._element.setAttribute("id","".concat(this._id)),this._likeButton=this._element.querySelector(".element__button"),this._trashButton=this._element.querySelector(".element__trash-button"),this._elementPhoto=this._element.querySelector(".element__photo"),this._likeCounter=this._element.querySelector(".element__like-counter"),this._elementPhoto.src=this._cardLink,this._elementPhoto.alt="Изображение "+this._cardName,this._element.querySelector(".element__text").textContent=this._cardName,this._setEventListeners(),this._checkOwnLike(),this._checkisCardOwn(),this.updateLikeCount(this._cardLikes),this._element}},{key:"_setEventListeners",value:function(){var e=this;this._likeButton.addEventListener("click",(function(){e._handleButtonClick()})),this._trashButton.addEventListener("click",(function(){e._handeTrashButtonClick()})),this._elementPhoto.addEventListener("click",(function(){e._handleCardClick()}))}},{key:"_handleButtonClick",value:function(){this._likeButton.classList.contains("element__button_active")?(this._deleteLikeClass(),this._dislike(this._id)):(this._addLikeClass(),this._like(this._id))}},{key:"_addLikeClass",value:function(){this._likeButton.classList.add("element__button_active")}},{key:"_deleteLikeClass",value:function(){this._likeButton.classList.remove("element__button_active")}},{key:"_checkOwnLike",value:function(){var e=this;this._likes.some((function(t){return t._id===e._ownerId}))?this._addLikeClass():this._deleteLikeClass()}},{key:"updateLikeCount",value:function(e){this._likeCounter.textContent=e}},{key:"_handeTrashButtonClick",value:function(){this._handleDeleteCard(this._id,this._element)}},{key:"_checkisCardOwn",value:function(){this._cardOwnerId!==this._ownerId&&this._hideTrashButton()}},{key:"_hideTrashButton",value:function(){this._trashButton.classList.add("element__trash-button_inactive")}}])&&e(n.prototype,o),t}();function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var o=function(){function e(t,n){var o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=o,this._container=document.querySelector(n)}var t,o;return t=e,(o=[{key:"renderItems",value:function(e,t){var n=this;e.forEach((function(e){n.addItem(e,t)}))}},{key:"addItem",value:function(e,t){"initial"===t&&this._container.append(this._renderer(e)),"additional"===t&&this._container.prepend(this._renderer(e))}}])&&n(t.prototype,o),e}();function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var i=function(){function e(t){var n=t.userInfoNameSelector,o=t.userInfoDescriptionSelector,r=t.userInfoAvatarSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._userInfoNameSelector=n,this._userInfoDescriptionSelector=o,this._userInfoAvatarSelector=r,this._userName=document.querySelector(this._userInfoNameSelector),this._userDescription=document.querySelector(this._userInfoDescriptionSelector),this._userAvatar=document.querySelector(this._userInfoAvatarSelector)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){var e={};return e.userName=this._userName.textContent,e.userDescription=this._userDescription.textContent,e.userAvatar=this._userAvatar.src,e}},{key:"setUserInfo",value:function(e){this._userName.textContent=e.name,this._userDescription.textContent=e.about,this._userAvatar.src=e.avatar}},{key:"updateAvatar",value:function(e){this._userAvatar.src=e.avatar}}])&&r(t.prototype,n),e}();function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keyup",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keyup",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"setEventListeners",value:function(){var e=this;this._popup.addEventListener("click",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__close-icon"))&&e.close()}))}}])&&a(t.prototype,n),e}();function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(a,e);var t,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(o);if(r){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return h(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._popupPhotoImg=t._popup.querySelector(".popup__img"),t._popupPhotoDescription=t._popup.querySelector(".popup__description"),t}return t=a,(n=[{key:"open",value:function(e,t){this._popupPhotoImg.setAttribute("src",t),this._popupPhotoImg.setAttribute("alt",e),this._popupPhotoDescription.textContent=e,l(p(a.prototype),"open",this).call(this)}}])&&u(t.prototype,n),a}(s);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function v(e,t,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(a,e);var t,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(o);if(r){var n=k(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return b(this,e)});function a(e,t){var n,o=t.submit,r=t.setInputs;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e))._submit=o,n._inputList=n._popup.querySelectorAll(".form__item"),n._setInputs=r,n._button=n._popup.querySelector(".form__button"),n._buttonText=n._button.textContent,n}return t=a,(n=[{key:"open",value:function(){v(k(a.prototype),"open",this).call(this),this._setInputs()}},{key:"_getInputValues",value:function(){var e=this;return this._formValues={},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"setEventListeners",value:function(){var e=this;v(k(a.prototype),"setEventListeners",this).call(this),this._popup.addEventListener("submit",(function(t){t.preventDefault(),e._submit(e._getInputValues())}))}},{key:"close",value:function(){v(k(a.prototype),"close",this).call(this),this._popup.querySelector(".form__container").reset()}},{key:"renderLoading",value:function(e){this._button.textContent=e?"Сохранение...":this._buttonText}}])&&y(t.prototype,n),a}(s);function C(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var S=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formElement=n,this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._buttonElement=this._formElement.querySelector(this._submitButtonSelector),this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector))}var t,n;return t=e,(n=[{key:"enableValidation",value:function(){this._setEventListeners()}},{key:"_setEventListeners",value:function(){var e=this;this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkValidity(t),e._toggleButtonState()}))})),this._toggleButtonState()}},{key:"_checkValidity",value:function(e){e.validity.valid?this._hideError(e):this._showError(e)}},{key:"_hideError",value:function(e){var t=this._formElement.querySelector(".".concat(e.id,"-error"));t.textContent="",t.classList.remove(this._errorClass),e.classList.remove(this._inputErrorClass)}},{key:"_showError",value:function(e){var t=this._formElement.querySelector(".".concat(e.id,"-error"));t.textContent=e.validationMessage,t.classList.add(this._errorClass),e.classList.add(this._inputErrorClass)}},{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(e){return!e.validity.valid}))}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1)}},{key:"clearValidation",value:function(){var e=this;this._inputList.forEach((function(t){e._hideError(t)})),this._toggleButtonState()}}])&&C(t.prototype,n),e}();function E(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var w=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._options=t,this._baseUrl=t.baseUrl,this._headerAuthorization=t.headers.authorization,this._contentType=t.headers["Content-Type"]}var t,n;return t=e,(n=[{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}},{key:"getInitialCards",value:function(){return fetch("".concat(this._baseUrl,"cards"),{method:"GET",headers:{authorization:this._headerAuthorization,"Content-Type":this._contentType}}).then(this._checkResponse)}},{key:"getUserInfo",value:function(){return fetch("".concat(this._baseUrl,"users/me"),{method:"GET",headers:{authorization:this._headerAuthorization,"Content-Type":this._contentType}}).then(this._checkResponse)}},{key:"updateUserInfo",value:function(e){return fetch("".concat(this._baseUrl,"users/me"),{method:"PATCH",headers:{authorization:this._headerAuthorization,"Content-Type":this._contentType},body:JSON.stringify({name:e.name,about:e.description})}).then(this._checkResponse)}},{key:"insertNewCard",value:function(e){return fetch("".concat(this._baseUrl,"cards"),{method:"POST",headers:{authorization:this._headerAuthorization,"Content-Type":this._contentType},body:JSON.stringify({name:e.name,link:e.link})}).then(this._checkResponse)}},{key:"putLike",value:function(e){return fetch("".concat(this._baseUrl,"cards/likes/").concat(e),{method:"PUT",headers:{authorization:this._headerAuthorization,"Content-Type":this._contentType}}).then(this._checkResponse)}},{key:"deleteLike",value:function(e){return fetch("".concat(this._baseUrl,"cards/likes/").concat(e),{method:"DELETE",headers:{authorization:this._headerAuthorization,"Content-Type":this._contentType}}).then(this._checkResponse)}},{key:"updateAvatar",value:function(e){return fetch("".concat(this._baseUrl,"users/me/avatar"),{method:"PATCH",headers:{authorization:this._headerAuthorization,"Content-Type":this._contentType},body:JSON.stringify({avatar:e.link})}).then(this._checkResponse)}},{key:"deletePhoto",value:function(e){return fetch("".concat(this._baseUrl,"cards/").concat(e),{method:"DELETE",headers:{authorization:this._headerAuthorization,"Content-Type":this._contentType}}).then(this._checkResponse)}}])&&E(t.prototype,n),e}();function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e,t){return!t||"object"!==L(t)&&"function"!=typeof t?P(e):t}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t,n){return(j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=R(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(a,e);var t,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=R(o);if(r){var n=R(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return T(this,e)});function a(e,t){var n,o,r,s,c,u=t.api;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),c=function(e){e.preventDefault(),o._api(o._id,o._element)},(s="_deleteCard")in(r=P(o=i.call(this,e)))?Object.defineProperty(r,s,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[s]=c,o._api=u,j((n=P(o),R(a.prototype)),"setEventListeners",n).call(n),o}return t=a,(n=[{key:"open",value:function(e,t){j(R(a.prototype),"open",this).call(this),this._popup.addEventListener("submit",this._deleteCard),this._id=e,this._element=t}},{key:"close",value:function(){j(R(a.prototype),"close",this).call(this),this._popup.removeEventListener("submit",this._deleteCard)}}])&&O(t.prototype,n),a}(s),q=document.querySelector("#popup__edit-profile"),A=document.querySelector("#popup__edit-card"),D=document.querySelector(".profile__edit-button"),U=q.querySelector(".form__container"),x=document.querySelector(".profile__add-button"),z=A.querySelector(".form__container"),N=document.querySelector("#profile-name-input"),V=document.querySelector("#profile-description-input"),J=document.querySelector(".profile__button-avatar-change"),G=document.querySelector("#popup__edit-avatar").querySelector(".form__container"),H={formSelector:".form__container",inputSelector:".form__item",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__item_type_error",errorClass:"form__item-error_active"},M=null,F=new w({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-25/",headers:{authorization:"bbfa3ff1-62aa-4f58-bfbd-0546f73cf56a","Content-Type":"application/json"}}),K=new B("#popup__confirm",{api:function(e,t){F.deletePhoto(e).then((function(){t.remove()})).then((function(){K.close()})).catch((function(e){console.log(e)}))}}),Q=new o({renderer:function(e){var n=new t("#cards",M,e,{handleCardClick:function(){X.open(e.name,e.link)},like:function(e){F.putLike(e).then((function(e){return e.likes.length})).then((function(e){n.updateLikeCount(e)})).catch((function(e){console.log(e)}))},dislike:function(e){F.deleteLike(e).then((function(e){return e.likes.length})).then((function(e){n.updateLikeCount(e)})).catch((function(e){console.log(e)}))},handleDeleteCard:function(e,t){K.open(e,t)}});return n.generateCard()}},".elements");F.getUserInfo().then((function(e){Z.setUserInfo(e),M=e._id})).catch((function(e){console.log(e)})).then((function(){F.getInitialCards().then((function(e){Q.renderItems(e,"initial")})).catch((function(e){console.log(e)}))}));var W=new g("#popup__edit-profile",{submit:function(e){W.renderLoading(!0),F.updateUserInfo(e).then((function(e){Z.setUserInfo(e)})).then((function(){W.close()})).catch((function(e){console.log(e)})).finally((function(){W.renderLoading(!1)}))},setInputs:function(){N.value=Z.getUserInfo().userName,V.value=Z.getUserInfo().userDescription,ee.clearValidation()}}),X=new _("#popup-photo"),Y=new g("#popup__edit-card",{submit:function(e){Y.renderLoading(!0),F.insertNewCard(e).then((function(e){Q.addItem(e,"additional")})).then((function(){Y.close()})).catch((function(e){console.log(e)})).finally((function(){Y.renderLoading(!1)}))},setInputs:function(){$.clearValidation()}}),Z=new i({userInfoNameSelector:".profile__name",userInfoDescriptionSelector:".profile__description",userInfoAvatarSelector:".profile__avatar"}),$=new S(H,z),ee=new S(H,U),te=new S(H,G);x.addEventListener("click",(function(){Y.open()})),D.addEventListener("click",(function(){W.open()})),Y.setEventListeners(),W.setEventListeners(),$.enableValidation(),ee.enableValidation(),X.setEventListeners(),J.addEventListener("click",(function(){ne.open()}));var ne=new g("#popup__edit-avatar",{submit:function(e){ne.renderLoading(!0),F.updateAvatar(e).then((function(e){Z.updateAvatar(e)})).then((function(){ne.close()})).catch((function(e){console.log(e)})).finally((function(){ne.renderLoading(!1)}))},setInputs:function(){te.clearValidation()}});ne.setEventListeners(),te.enableValidation()})();
//# sourceMappingURL=main.js.map